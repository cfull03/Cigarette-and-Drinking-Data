# filepath: experiments/exp-001-smoking-trends/experiment.yml
# Experiment manifest – documents inputs, code, settings, and outputs
version: 1
meta:
  id: exp-001-smoking-trends
  title: Smoking trends – RF baseline with robust preprocessing
  author: Christian Fullerton
  created: "2025-11-11"
  description: >
    RandomForest baseline trained on engineered features with a fitted ColumnTransformer
    that safely handles all-NaN columns. Eval splits held-out test via train_test_split_safe.

git:
  repo: https://github.com/cfull03/Cigarette-and-Drinking-Data
  branch: exp/001-smoking-trends-cf        # <- update if different
  commit: "b2b7a589fd233f50385312a14f2694fae478b3ff"           # git rev-parse HEAD
  changed_files:
    - Makefile
    - pyproject.toml
    - addiction/__init__.py
    - addiction/eval.py
    - addiction/preprocessor.py
    - addiction/modeling/__init__.py
    - addiction/modeling/train.py
    - addiction/modeling/predict.py

environment:
  conda_env: cigarette-and-drinking-data
  python: "3.12"
  dependencies:
    - numpy>=1.26
    - pandas>=2.1
    - scikit-learn>=1.4
    - scipy>=1.8
    - typer>=0.9
    - loguru>=0.7
    - python-dotenv>=1.0
    - tqdm>=4.66
    - joblib>=1.3
  commands:
    - conda env update -n cigarette-and-drinking-data -f environment.yml --prune
    - pip install -e .

data:
  raw: data/raw/addiction_population_data.csv
  interim: data/interim/dataset.csv
  features: data/processed/features.csv            # includes target
  preprocessed_X: data/processed/dataset.preprocessed.csv
  target: has_health_issues

preprocessing:
  module: addiction.preprocessor
  model_path: models/preprocessor.joblib
  strategy:
    numeric_some: median + StandardScaler
    numeric_all_nan: constant(0.0) + StandardScaler
    categorical_some: most_frequent + OneHotEncoder(handle_unknown=ignore)
    categorical_all_nan: constant("missing") + OneHotEncoder(handle_unknown=ignore)
  notes: >
    Preprocessor drops target and any '<target>_*' derived columns before fitting/transforming.

training:
  module: addiction.modeling.train
  algorithm: RandomForestClassifier
  input_csv: data/processed/features.csv
  output_model: artifacts/rf/model.joblib
  hyperparameters:
    n_estimators: 500
    max_depth: 5
    max_features: "sqrt"
    min_samples_leaf: 1
    class_weight: "balanced"
    n_jobs: -1
    random_state: 42
  split:
    test_size: 0.2
    stratify: true

evaluation:
  module: addiction.eval
  input_csv: data/processed/features.csv
  metrics_path: artifacts/rf/metrics.json
  uses_preprocessor: true
  metrics_expected_keys:
    - accuracy
    - f1
    - precision
    - recall
    - roc_auc
    - confusion_matrix
    - n_samples

artifacts:
  model: artifacts/rf/model.joblib
  preprocessor: models/preprocessor.joblib
  predictions: artifacts/rf/predictions.csv
  figures_dir: experiments/exp-001-smoking-trends/results/figures

repro:
  make_targets:
    - make data
    - make features
    - make preprocess
    - make build
    - make eval
    - make predict

